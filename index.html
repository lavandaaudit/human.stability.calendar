<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium.stability.human.lab.live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{
  width:100%;
  height:100%;
  background:#000;
  color:#cfefff;
  font-family:Inter, monospace;
  overflow:hidden;
}

/* ===== LAYOUT ===== */
#wrap{
  position:relative;
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

#panel{
  position:relative;
  width:92%;
  height:88%;
  display:flex;
  gap:24px;
}

/* ===== LEFT LIST ===== */
#list{
  width:38%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:8px;
}

/* ===== RIGHT DIAGRAM ===== */
#diagram{
  width:62%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}

#breath{
  width:100%;
  height:80%;
}

/* ===== INDICATORS ===== */
.indicator{
  font-size:15px;
  padding:3px 6px;
  text-align:left;
  transition:color .5s ease;
}
.green{color:#00ff88;}
.yellow{color:#fff3a0;animation:pulse 2s infinite;}
.red{color:#ffb3b8;animation:pulse 1s infinite;}

@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

/* ===== STARS ===== */
#stars{
  position:fixed;
  inset:0;
  z-index:-1;
}
canvas{display:block;}
</style>
</head>

<body>

<canvas id="stars"></canvas>

<div id="wrap">
  <div id="panel">
    <div id="list"></div>
    <div id="diagram">
      <canvas id="breath"></canvas>
    </div>
  </div>
</div>

<script>
// ================== STARS ==================
const sc=document.getElementById("stars"),sctx=sc.getContext("2d");
function resizeStars(){sc.width=innerWidth;sc.height=innerHeight}
resizeStars();addEventListener("resize",resizeStars);
const stars=[...Array(300)].map(()=>({x:(Math.random()-.5)*innerWidth,y:(Math.random()-.5)*innerHeight,z:Math.random()*innerWidth}));
function drawStars(){
  sctx.fillStyle="#000";sctx.fillRect(0,0,sc.width,sc.height);
  stars.forEach(s=>{
    s.z-=2;if(s.z<1){s.z=innerWidth;s.x=(Math.random()-.5)*innerWidth;s.y=(Math.random()-.5)*innerHeight}
    const k=500/s.z,x=s.x*k+sc.width/2,y=s.y*k+sc.height/2;
    sctx.fillStyle="white";sctx.fillRect(x,y,1.5,1.5);
  });
  requestAnimationFrame(drawStars);
}
drawStars();

// ================== INDICATORS ==================
const listEl=document.getElementById("list");
const indicators={},history={};
const MAX_POINTS=120;

function level(v){return v<0.4?"green":v<0.7?"yellow":"red"}

function remember(n,v){
  if(!history[n])history[n]=[];
  history[n].push(v);
  if(history[n].length>MAX_POINTS)history[n].shift();
}

function addOrUpdate(n,val,norm=0.5){
  remember(n,norm);
  if(indicators[n]){
    indicators[n].textContent=`${n}: ${val}`;
    indicators[n].className=`indicator ${level(norm)}`;
  }else{
    const d=document.createElement("div");
    d.className=`indicator ${level(norm)}`;
    d.textContent=`${n}: ${val}`;
    listEl.appendChild(d);
    indicators[n]=d;
  }
}

// ================== FETCH ==================
async function fetchJSON(u){
  try{
    const r=await fetch("https://api.allorigins.win/get?url="+encodeURIComponent(u));
    const j=await r.json();
    return JSON.parse(j.contents);
  }catch{return null;}
}

// ================== DATA ==================
async function fetchData(){
  const plasma=await fetchJSON("https://services.swpc.noaa.gov/products/solar-wind/plasma-6-hour.json");
  const mag=await fetchJSON("https://services.swpc.noaa.gov/products/solar-wind/mag-6-hour.json");
  const kp=await fetchJSON("https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json");

  if(plasma?.length){
    const l=plasma.at(-1);
    addOrUpdate("Solar Wind Speed (km/s)",l[1],Math.min(1,l[1]/1000));
    addOrUpdate("Solar Wind Density (/cc)",l[2],Math.min(1,l[2]/50));
    addOrUpdate("Solar Wind Temp (K)",l[3],Math.min(1,l[3]/200000));
    addOrUpdate("Solar Wind Pressure (nPa)",l[6],Math.min(1,l[6]/10));
  }

  if(mag?.length){
    const l=mag.at(-1);
    addOrUpdate("IMF Bz (nT)",l[4],Math.min(1,Math.abs(l[4])/20));
    addOrUpdate("IMF Bt (nT)",l[1],Math.min(1,l[1]/30));
    addOrUpdate("IMF By (nT)",l[3],Math.min(1,Math.abs(l[3])/20));
  }

  if(kp?.length)addOrUpdate("Kp Index",kp.at(-1)[1],kp.at(-1)[1]/9);

  const eq=await fetchJSON("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson");
  if(eq?.features){
    addOrUpdate("EQ Count (hour)",eq.features.length,Math.min(1,eq.features.length/10));
  }

  const dst=await fetchJSON("https://services.swpc.noaa.gov/json/kyoto-dst.json");
  if(dst?.length)addOrUpdate("Dst Index (nT)",dst.at(-1).dst,Math.min(1,Math.abs(dst.at(-1).dst)/200));

  const ae=await fetchJSON("https://services.swpc.noaa.gov/json/ae-index.json");
  if(ae?.length)addOrUpdate("AE Index",ae.at(-1).ae,Math.min(1,ae.at(-1).ae/2000));

  const p=await fetchJSON("https://services.swpc.noaa.gov/json/goes/primary/integral-protons.json");
  if(p?.length)addOrUpdate("Proton Flux >10 MeV",p.at(-1).flux,Math.min(1,p.at(-1).flux/1000));

  const e=await fetchJSON("https://services.swpc.noaa.gov/json/goes/primary/integral-electrons.json");
  if(e?.length)addOrUpdate("Electron Flux >2 MeV",e.at(-1).flux,Math.min(1,e.at(-1).flux/10000));

  const alerts=await fetchJSON("https://services.swpc.noaa.gov/json/alerts.json");
  const g=alerts?.find(a=>a.product_id?.startsWith("G"));
  if(g){
    const n={G1:.3,G2:.5,G3:.7,G4:.9,G5:1}[g.product_id]||.3;
    addOrUpdate("Geomagnetic Storm Level",g.product_id,n);
  }
}
fetchData();setInterval(fetchData,60000);

// ================== BREATH DIAGRAM ==================
const bc=document.getElementById("breath"),bctx=bc.getContext("2d");
function resizeBreath(){bc.width=bc.clientWidth;bc.height=bc.clientHeight}
resizeBreath();addEventListener("resize",resizeBreath);

function drawBreath(){
  bctx.clearRect(0,0,bc.width,bc.height);
  let i=0;
  for(const k in history){
    const d=history[k];if(d.length<2)continue;
    bctx.beginPath();
    bctx.strokeStyle=`hsla(${i*23%360},80%,70%,0.6)`;
    bctx.lineWidth=1;
    d.forEach((v,j)=>{
      const x=j/(MAX_POINTS-1)*bc.width;
      const y=bc.height/2 - v*120 + i*5;
      j?bctx.lineTo(x,y):bctx.moveTo(x,y);
    });
    bctx.stroke();i++;
  }
  requestAnimationFrame(drawBreath);
}
drawBreath();
</script>

</body>
</html>
