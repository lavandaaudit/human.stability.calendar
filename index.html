<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium.stability.human.lab.live v1.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#000;color:#cfefff;font-family:Inter,monospace;overflow:hidden}
#stars{position:fixed;inset:0;z-index:0}
#ui{position:relative;z-index:2;display:flex;height:100%}
#left{padding:18px;width:420px;overflow-y:auto}
#right{flex:1;padding:18px;overflow-y:auto;display:flex;flex-direction:column;align-items:center}

h1{font-size:16px;letter-spacing:2px;opacity:.8;margin-bottom:12px}
.section{margin-bottom:18px}
.section h2{font-size:12px;opacity:.7;margin-bottom:6px}

.indicator{
display:flex;justify-content:space-between;
padding:6px 8px;margin-bottom:4px;
font-size:13px;background:rgba(255,255,255,.05);
border-left:4px solid #333
}
.green{border-color:#00ff88;color:#9affd1}
.yellow{border-color:#ffcc00;color:#fff3a0;animation:pulse 2s infinite}
.red{border-color:#ff3344;color:#ffb3b8;animation:pulse 1s infinite}
@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

#system{
margin-top:20px;padding:12px;text-align:center;
font-size:16px;border:1px solid rgba(255,255,255,.25)
}

#heatmap{display:grid;grid-template-columns:repeat(5,60px);grid-gap:6px;margin-bottom:18px}
.heatcell{width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:10px;color:#000;font-weight:bold}
canvas{background:#111;border:1px solid rgba(255,255,255,.2);margin-bottom:18px}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<canvas id="stars"></canvas>

<div id="ui">
  <div id="left">
    <h1>IBONARIUM Â· STABILITY MATRIX</h1>

    <div class="section"><h2>COSMOS</h2><div id="cosmos"></div></div>
    <div class="section"><h2>PLANET</h2><div id="planet"></div></div>
    <div class="section"><h2>ECONOMY</h2><div id="economy"></div></div>
    <div class="section"><h2>SOCIAL</h2><div id="social"></div></div>

    <div id="system"></div>
  </div>

  <div id="right">
    <h1>Heatmap & Trends</h1>
    <div id="heatmap"></div>

    <canvas id="chartCosmos" width="400" height="150"></canvas>
    <canvas id="chartPlanet" width="400" height="150"></canvas>
    <canvas id="chartEconomy" width="400" height="150"></canvas>
    <canvas id="chartSocial" width="400" height="150"></canvas>
  </div>
</div>

<script>
// STARFIELD
const sc=document.getElementById("stars"),ctx=sc.getContext("2d");
let stars=[];
function resize(){
  sc.width=innerWidth; sc.height=innerHeight;
  stars=Array.from({length:500},()=>({x:Math.random()*innerWidth-innerWidth/2,y:Math.random()*innerHeight-innerHeight/2,z:Math.random()*innerWidth}));
}
window.onresize=resize; resize();
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,sc.width,sc.height);
  ctx.save(); ctx.translate(sc.width/2,sc.height/2);
  stars.forEach(s=>{
    s.z-=1.5; if(s.z<1) s.z=sc.width;
    const k=140/s.z, px=s.x*k, py=s.y*k;
    ctx.fillStyle="#fff"; ctx.fillRect(px,py,1,1);
  });
  ctx.restore();
  requestAnimationFrame(draw);
}
draw();

// CORE
const values=[];
function level(v){ return v<0.4?"green":v<0.7?"yellow":"red"; }
function add(el,name,val){
  values.push(val);
  const d=document.createElement("div");
  d.className=`indicator ${level(val)}`;
  d.innerHTML=`<span>${name}</span><span>${(val*100).toFixed(1)}</span>`;
  el.appendChild(d);
}

// HISTORY
const history = {
  "Solar Wind Speed": [], "Solar Wind Density": [], "IMF Bz": [], "Kp Index": [],
  "EQ Count": [], "Bitcoin": [], "Ethereum": [], "Fear & Greed": [],
  "News Intensity": [], "Conflict Tone": []
};

function updateHistory(name, value){
  history[name].push(value);
  if(history[name].length>60) history[name].shift();
}

// HEATMAP
const heatmapEl = document.getElementById("heatmap");
const heatKeys = Object.keys(history);
function drawHeatmap(){
  heatmapEl.innerHTML="";
  heatKeys.forEach(k=>{
    const v = history[k].at(-1) ?? 0;
    const div = document.createElement("div");
    div.className="heatcell";
    div.style.background = level(v)=="green"?"#00ff88":level(v)=="yellow"?"#ffcc00":"#ff3344";
    div.textContent=k.split(" ")[0];
    heatmapEl.appendChild(div);
  });
}

// COSMOS
async function cosmos(){
  try{
    const plasma = await fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-6-hour.json").then(r=>r.json());
    const mag = await fetch("https://services.swpc.noaa.gov/products/solar-wind/mag-6-hour.json").then(r=>r.json());
    const kpAll = await fetch("https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json").then(r=>r.json());

    const lastPl = plasma.at(-1);
    const lastMag = mag.at(-1);
    const lastKp = kpAll.at(-1)[1];

    const v1=Math.min(lastPl[1]/1000,1);
    const v2=Math.min(lastPl[2]/20,1);
    const v3=Math.min(Math.abs(lastMag[4])/20,1);
    const v4=Math.min(lastKp/9,1);

    add(cosmosEl,"Solar Wind Speed",v1);
    add(cosmosEl,"Solar Wind Density",v2);
    add(cosmosEl,"IMF Bz",v3);
    add(cosmosEl,"Kp Index",v4);

    updateHistory("Solar Wind Speed",v1);
    updateHistory("Solar Wind Density",v2);
    updateHistory("IMF Bz",v3);
    updateHistory("Kp Index",v4);
  }catch(e){console.error("COSMOS API error",e);}
}

// PLANET
async function planet(){
  try{
    const eq = await fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson").then(r=>r.json());
    const v = Math.min(eq.features.length/20,1);
    add(planetEl,"EQ Count",v);
    updateHistory("EQ Count",v);
  }catch(e){console.error("PLANET API error",e);}
}

// ECONOMY
async function economy(){
  try{
    const p = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd").then(r=>r.json());
    const fgRaw = await fetch("https://api.allorigins.win/raw?url=https://api.alternative.me/fng/").then(r=>r.json());
    const fgValue = parseFloat(fgRaw.data[0].value)/100;

    const v1 = Math.min(p.bitcoin.usd/100000,1);
    const v2 = Math.min(p.ethereum.usd/10000,1);
    const v3 = Math.min(fgValue,1);

    add(economyEl,"Bitcoin",v1);
    add(economyEl,"Ethereum",v2);
    add(economyEl,"Fear & Greed",v3);

    updateHistory("Bitcoin",v1);
    updateHistory("Ethereum",v2);
    updateHistory("Fear & Greed",v3);
  }catch(e){console.error("ECONOMY API error",e);}
}

// SOCIAL
async function social(){
  try{
    const urls = [
      "https://www.reddit.com/r/worldnews/.json?limit=100",
      "https://www.reddit.com/r/news/.json?limit=100"
    ];
    let titles = "";
    for(const url of urls){
      const data = await fetch(url).then(r=>r.json());
      titles += data.data.children.map(a=>a.data.title).join(" ");
    }
    const totalWords = titles.split(/\s+/).length;
    const conflictCount = (titles.match(/war|conflict|attack|crisis|earthquake|flood/gi) || []).length;

    const v1 = Math.min(totalWords/1000,1);
    const v2 = Math.min(conflictCount/50,1);

    add(socialEl,"News Intensity",v1);
    add(socialEl,"Conflict Tone",v2);

    updateHistory("News Intensity",v1);
    updateHistory("Conflict Tone",v2);
  }catch(e){console.error("SOCIAL API error",e);}
}

// SYSTEM
function systemState(){
  const avg = values.reduce((a,b)=>a+b,0)/values.length;
  const s = document.getElementById("system");
  s.className = level(avg);
  s.textContent = "SYSTEM STATE: "+(avg<0.4?"STABLE":avg<0.7?"TRANSITION":"CRITICAL");
}

// CHARTS
const chartCosmos = new Chart(document.getElementById('chartCosmos').getContext('2d'),{
  type:'line',data:{labels:Array(60).fill(''),datasets:[
    {label:'Solar Wind Speed',data:[],borderColor:'#0f0',fill:false},
    {label:'Solar Wind Density',data:[],borderColor:'#0ff',fill:false},
    {label:'IMF Bz',data:[],borderColor:'#ff0',fill:false},
    {label:'Kp Index',data:[],borderColor:'#f0f',fill:false}
  ]},options:{animation:false,responsive:true,scales:{y:{min:0,max:1}}}
});

const chartPlanet = new Chart(document.getElementById('chartPlanet').getContext('2d'),{
  type:'line',data:{labels:Array(60).fill(''),datasets:[
    {label:'EQ Count',data:[],borderColor:'#0ff',fill:false}
  ]},options:{animation:false,responsive:true,scales:{y:{min:0,max:1}}}
});

const chartEconomy = new Chart(document.getElementById('chartEconomy').getContext('2d'),{
  type:'line',data:{labels:Array(60).fill(''),datasets:[
    {label:'Bitcoin',data:[],borderColor:'#0f0',fill:false},
    {label:'Ethereum',data:[],borderColor:'#0ff',fill:false},
    {label:'Fear & Greed',data:[],borderColor:'#ff0',fill:false}
  ]},options:{animation:false,responsive:true,scales:{y:{min:0,max:1}}}
});

const chartSocial = new Chart(document.getElementById('chartSocial').getContext('2d'),{
  type:'line',data:{labels:Array(60).fill(''),datasets:[
    {label:'News Intensity',data:[],borderColor:'#0f0',fill:false},
    {label:'Conflict Tone',data:[],borderColor:'#f00',fill:false}
  ]},options:{animation:false,responsive:true,scales:{y:{min:0,max:1}}}
});

// UPDATE CHARTS
function updateCharts(){
  // COSMOS
  chartCosmos.data.datasets[0].data = history["Solar Wind Speed"];
  chartCosmos.data.datasets[1].data = history["Solar Wind Density"];
  chartCosmos.data.datasets[2].data = history["IMF Bz"];
  chartCosmos.data.datasets[3].data = history["Kp Index"];
  chartCosmos.update();

  chartPlanet.data.datasets[0].data = history["EQ Count"];
  chartPlanet.update();

  chartEconomy.data.datasets[0].data = history["Bitcoin"];
  chartEconomy.data.datasets[1].data = history["Ethereum"];
  chartEconomy.data.datasets[2].data = history["Fear & Greed"];
  chartEconomy.update();

  chartSocial.data.datasets[0].data = history["News Intensity"];
  chartSocial.data.datasets[1].data = history["Conflict Tone"];
  chartSocial.update();
}

// TICK LOOP
async function tick(){
  values.length=0;
  cosmosEl.innerHTML=planetEl.innerHTML=economyEl.innerHTML=socialEl.innerHTML="";
  await cosmos();
  await planet();
  await economy();
  await social();
  systemState();
  drawHeatmap();
  updateCharts();
}

const cosmosEl=document.getElementById("cosmos");
const planetEl=document.getElementById("planet");
const economyEl=document.getElementById("economy");
const socialEl=document.getElementById("social");

tick();
setInterval(tick,60000);
</script>

</body>
</html>
