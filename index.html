<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium.stability.human.lab.live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#000;color:#cfefff;font-family:Inter,monospace;overflow:hidden}

#stars{position:fixed;inset:0;z-index:0}
#ui{position:relative;z-index:2;display:grid;grid-template-columns:420px 1fr;height:100%}

#left{padding:18px;overflow-y:auto;font-size:14px}
h1{font-size:16px;letter-spacing:3px;opacity:.8;margin-bottom:12px}
.section{margin-bottom:18px}
.section h2{font-size:13px;opacity:.7;margin-bottom:6px}

.indicator{
display:flex;justify-content:space-between;
padding:6px 8px;margin-bottom:4px;
font-size:13px;background:rgba(255,255,255,.04);
border-left:4px solid #333
}
.green{border-color:#00ff88;color:#9affd1}
.yellow{border-color:#ffcc00;color:#fff3a0;animation:pulse 2s infinite}
.red{border-color:#ff3344;color:#ffb3b8;animation:pulse 1s infinite}

@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

#system{
margin-top:20px;padding:12px;text-align:center;
font-size:16px;border:1px solid rgba(255,255,255,.25)
}

#charts{
padding:16px;
display:grid;
grid-template-columns:repeat(3,1fr);
grid-template-rows:repeat(4,1fr);
gap:10px
}
canvas.chart{
background:rgba(255,255,255,.03);
border:1px solid rgba(255,255,255,.08)
}
</style>
</head>

<body>

<canvas id="stars"></canvas>

<div id="ui">
<div id="left">
<h1>IBONARIUM · STABILITY MATRIX</h1>

<div class="section"><h2>COSMOS</h2><div id="cosmos"></div></div>
<div class="section"><h2>PLANET</h2><div id="planet"></div></div>
<div class="section"><h2>ECONOMY</h2><div id="economy"></div></div>
<div class="section"><h2>SOCIAL</h2><div id="social"></div></div>

<div id="system"></div>
</div>

<div id="charts">
<canvas class="chart"></canvas><canvas class="chart"></canvas><canvas class="chart"></canvas>
<canvas class="chart"></canvas><canvas class="chart"></canvas><canvas class="chart"></canvas>
<canvas class="chart"></canvas><canvas class="chart"></canvas><canvas class="chart"></canvas>
<canvas class="chart"></canvas><canvas class="chart"></canvas><canvas class="chart"></canvas>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* STARFIELD */
const sc=document.getElementById("stars"),ctx=sc.getContext("2d");
let stars=[];
function resize(){
sc.width=innerWidth;sc.height=innerHeight;
stars=Array.from({length:500},()=>({
x:Math.random()*innerWidth-innerWidth/2,
y:Math.random()*innerHeight-innerHeight/2,
z:Math.random()*innerWidth
}))
}
window.onresize=resize;resize();
function draw(){
ctx.fillStyle="#000";ctx.fillRect(0,0,sc.width,sc.height);
ctx.translate(sc.width/2,sc.height/2);
stars.forEach(s=>{
s.z-=1.5;if(s.z<1)s.z=sc.width;
const k=140/s.z,px=s.x*k,py=s.y*k;
ctx.fillStyle="#fff";ctx.fillRect(px,py,1,1)
});
ctx.setTransform(1,0,0,1,0,0);
requestAnimationFrame(draw)
}
draw();

/* UTILS */
const level=v=>v<0.4?"green":v<0.7?"yellow":"red";
const add=(el,name,val)=>{
const d=document.createElement("div");
d.className=`indicator ${level(val)}`;
d.innerHTML=`<span>${name}</span><span>${(val*100).toFixed(1)}</span>`;
el.appendChild(d)
}

/* CHARTS */
const charts=[];
const buffers=Array.from({length:12},()=>[]);
document.querySelectorAll(".chart").forEach((c,i)=>{
charts[i]=new Chart(c,{
type:"line",
data:{labels:[],datasets:[{data:[],borderColor:'#00ffff',backgroundColor:'#00ffff22',fill:true}]},
options:{
animation:false,
plugins:{legend:{display:false}},
scales:{x:{display:false},y:{display:true,ticks:{color:'white'}}},
responsive:true
}
})
});
function pushChart(i,val){
const b=buffers[i];
b.push(val);if(b.length>60)b.shift();
charts[i].data.labels=b.map(()=> "");
charts[i].data.datasets[0].data=b;
charts[i].update();
}

/* FETCH & UPDATE DATA */
const cosmosEl=document.getElementById("cosmos");
const planetEl=document.getElementById("planet");
const economyEl=document.getElementById("economy");
const socialEl=document.getElementById("social");
const systemEl=document.getElementById("system");

let cosmosData=[],planetData=[],economyData=[],socialData=[];

async function getData(){
cosmosEl.innerHTML="";planetEl.innerHTML="";economyEl.innerHTML="";socialEl.innerHTML="";
cosmosData=[];planetData=[];economyData=[];socialData=[];

// COSMOS
try{
const sw=await fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-1-day.json").then(r=>r.json());
const kp=await fetch("https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json").then(r=>r.json());
const l=sw.at(-1);
const kpLast=kp.at(-1);
const vals=[
l[2]/800, // speed
l[1]/50,  // density
Math.abs(l[4])/10, // IMF Bz
kpLast[1]/9 // Kp
];
const names=["Solar Wind Speed","Density","IMF Bz","Kp Index"];
vals.forEach((v,i)=>{add(cosmosEl,names[i],v);cosmosData.push(v);pushChart(i,v)});
}catch(e){console.log("COSMOS ERROR",e)}

// PLANET
try{
const eq=await fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson").then(r=>r.json());
const vals=[Math.random(),Math.random(),Math.min(eq.features.length/20,1),Math.random()];
const names=["Pressure Anomaly","Wind Anomaly","EQ Count","Seismic Energy"];
vals.forEach((v,i)=>{add(planetEl,names[i],v);planetData.push(v);pushChart(i+4,v)});
}catch(e){console.log("PLANET ERROR",e)}

// ECONOMY
try{
const p=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd").then(r=>r.json());
const fg=await fetch("https://api.allorigins.win/raw?url=https://api.alternative.me/fng/").then(r=>r.json());
const vals=[p.bitcoin.usd/100000,p.ethereum.usd/10000,fg.data[0].value/100,(p.bitcoin.usd/100000 + p.ethereum.usd/10000 + fg.data[0].value/100)/3];
const names=["Bitcoin","Ethereum","Fear & Greed","Market Stress"];
vals.forEach((v,i)=>{add(economyEl,names[i],v);economyData.push(v);pushChart(i+8,v)});
}catch(e){console.log("ECONOMY ERROR",e)}

// SOCIAL (рандомні індикатори)
const socialNames=["Conflict Tone","Event Density","News Intensity","Reddit Stress","Global Stress"];
const socialVals=socialNames.map(()=>Math.random());
socialVals.forEach((v,i)=>{add(socialEl,socialNames[i],v);socialData.push(v)});

// SYSTEM STATE
const allVals=[...cosmosData,...planetData,...economyData,...socialData];
const avg=allVals.reduce((a,b)=>a+b,0)/allVals.length;
systemEl.className=level(avg);
systemEl.textContent="SYSTEM STATE: "+(avg<0.4?"STABLE":avg<0.7?"TRANSITION":"CRITICAL");
}

// INITIAL FETCH & LOOP
getData();
setInterval(getData,60000);

</script>

</body>
</html>
