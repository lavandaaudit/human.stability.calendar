<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium.stability.human.lab.live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#000;color:#cfefff;font-family:Inter,monospace;overflow:hidden}
#stars{position:fixed;inset:0;z-index:0}
#ui{position:relative;z-index:2;display:grid;grid-template-columns:420px 1fr;height:100%}
#left{padding:16px;overflow-y:auto}
h1{font-size:13px;letter-spacing:3px;opacity:.7;margin-bottom:12px}
.section{margin-bottom:18px}
.section h2{font-size:11px;opacity:.6;margin-bottom:6px}
.indicator{
display:flex;justify-content:space-between;
padding:6px 8px;margin-bottom:4px;
font-size:12px;background:rgba(255,255,255,.04);
border-left:4px solid #333
}
.green{border-color:#00ff88;color:#9affd1}
.yellow{border-color:#ffcc00;color:#fff3a0;animation:pulse 2s infinite}
.red{border-color:#ff3344;color:#ffb3b8;animation:pulse 1s infinite}
@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}
#system{margin-top:18px;padding:12px;text-align:center;font-size:15px;border:1px solid rgba(255,255,255,.25)}
#charts{
padding:14px;
display:grid;
grid-template-columns:repeat(3,1fr);
grid-template-rows:repeat(4,1fr);
gap:10px
}
canvas{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08)}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div id="ui">
<div id="left">
<h1>IBONARIUM Â· STABILITY MATRIX</h1>

<div class="section"><h2>COSMOS</h2><div id="cosmos"></div></div>
<div class="section"><h2>PLANET</h2><div id="planet"></div></div>
<div class="section"><h2>ECONOMY</h2><div id="economy"></div></div>
<div class="section"><h2>SOCIAL</h2><div id="social"></div></div>

<div id="system"></div>
</div>

<div id="charts">
<canvas id="g1"></canvas><canvas id="g2"></canvas><canvas id="g3"></canvas>
<canvas id="g4"></canvas><canvas id="g5"></canvas><canvas id="g6"></canvas>
<canvas id="g7"></canvas><canvas id="g8"></canvas><canvas id="g9"></canvas>
<canvas id="g10"></canvas><canvas id="g11"></canvas><canvas id="g12"></canvas>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ---------- STARFIELD ---------- */
const sc=document.getElementById("stars"),ctx=sc.getContext("2d");
let stars=[];
function resize(){
sc.width=innerWidth;sc.height=innerHeight;
stars=Array.from({length:420},()=>({x:Math.random()*innerWidth-innerWidth/2,y:Math.random()*innerHeight-innerHeight/2,z:Math.random()*innerWidth}))}
window.onresize=resize;resize();
function draw(){
ctx.fillStyle="#000";ctx.fillRect(0,0,sc.width,sc.height);
ctx.translate(sc.width/2,sc.height/2);
stars.forEach(s=>{
s.z-=1.4;if(s.z<1)s.z=sc.width;
const k=120/s.z;
ctx.fillStyle="#fff";ctx.fillRect(s.x*k,s.y*k,1,1)
});
ctx.setTransform(1,0,0,1,0,0);
requestAnimationFrame(draw)}
draw();

/* ---------- CORE ---------- */
const proxy=u=>"https://api.allorigins.win/raw?url="+encodeURIComponent(u);
const values={cosmos:[],planet:[],economy:[],social:[]};
function level(v){return v<0.4?"green":v<0.7?"yellow":"red"}
function add(el,group,name,v){
values[group].push(v);
const d=document.createElement("div");
d.className=`indicator ${level(v)}`;
d.innerHTML=`<span>${name}</span><span>${v.toFixed(2)}</span>`;
el.appendChild(d)
}
const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;

/* ---------- DATA LOADERS ---------- */
async function cosmos(){
const sw=await fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-1-day.json").then(r=>r.json());
const kp=await fetch("https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json").then(r=>r.json());
const l=sw.at(-1);
add(cosmosEl,"cosmos","Solar Wind Speed",l[2]/800);
add(cosmosEl,"cosmos","Solar Wind Density",l[1]/50);
add(cosmosEl,"cosmos","IMF Bz",Math.abs(l[4])/10);
add(cosmosEl,"cosmos","Kp Index",kp.at(-1)[1]/9);
add(cosmosEl,"cosmos","Aurora Power",kp.at(-1)[1]/9);
add(cosmosEl,"cosmos","Geomagnetic Stress",(l[2]/800+kp.at(-1)[1]/9)/2);
}

async function planet(){
const eq=await fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson").then(r=>r.json());
add(planetEl,"planet","EQ Count",Math.min(eq.features.length/15,1));
add(planetEl,"planet","EQ Avg Mag",eq.features.reduce((a,b)=>a+b.properties.mag,0)/eq.features.length/10);
add(planetEl,"planet","Seismic Energy",Math.min(eq.features.length*0.08,1));
const met=await fetch("https://api.open-meteo.com/v1/forecast?latitude=50&longitude=30&hourly=pressure_msl,temperature_2m,wind_speed_10m").then(r=>r.json());
add(planetEl,"planet","Pressure Anomaly",Math.abs(met.hourly.pressure_msl[0]-1013)/40);
add(planetEl,"planet","Temp Anomaly",Math.abs(met.hourly.temperature_2m[0]-10)/30);
add(planetEl,"planet","Wind Anomaly",met.hourly.wind_speed_10m[0]/40);
}

async function economy(){
const prices=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd").then(r=>r.json());
const global=await fetch("https://api.coingecko.com/api/v3/global").then(r=>r.json());
const fg=await fetch(proxy("https://api.alternative.me/fng/")).then(r=>r.json());
add(economyEl,"economy","Bitcoin",prices.bitcoin.usd/100000);
add(economyEl,"economy","Ethereum",prices.ethereum.usd/10000);
add(economyEl,"economy","Market Volatility",Math.abs(global.data.market_cap_change_percentage_24h_usd)/10);
add(economyEl,"economy","Market Cap Shift",global.data.market_cap_change_percentage_24h_usd>0?0.3:0.7);
add(economyEl,"economy","Fear & Greed",fg.data[0].value/100);
add(economyEl,"economy","BTC Dominance",global.data.market_cap_percentage.btc/100);
}

async function social(){
const gd=await fetch(proxy("https://api.gdeltproject.org/api/v2/doc/doc?query=conflict%20OR%20crisis&mode=artlist&format=json&maxrecords=50")).then(r=>r.json());
add(socialEl,"social","Conflict Intensity",Math.min(gd.articles.length/50,1));
add(socialEl,"social","Event Density",Math.min(gd.articles.length/30,1));
add(socialEl,"social","Media Pressure",Math.min(gd.articles.length/40,1));
add(socialEl,"social","Collective Stress",(gd.articles.length/50+0.4)/2);
add(socialEl,"social","Global Tension",gd.articles.length/60);
add(socialEl,"social","Information Load",gd.articles.length/45);
}

/* ---------- CHART SYSTEM ---------- */
const charts=[];
function createChart(id,label){
const c=new Chart(document.getElementById(id),{
type:"line",
data:{labels:[],datasets:[{label,data:[],borderWidth:1,fill:false}]},
options:{animation:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{min:0,max:1}}}
});
charts.push(c);
return c;
}

const C={
c1:createChart("g1","Cosmos"),
c2:createChart("g2","Planet"),
c3:createChart("g3","Economy"),
c4:createChart("g4","Social"),
c5:createChart("g5","Physical"),
c6:createChart("g6","Human"),
c7:createChart("g7","Volatility"),
c8:createChart("g8","Conflict"),
c9:createChart("g9","System Avg"),
c10:createChart("g10","Instability"),
c11:createChart("g11","Transition"),
c12:createChart("g12","Critical")
};

function push(chart,v){
chart.data.labels.push("");
chart.data.datasets[0].data.push(v);
if(chart.data.datasets[0].data.length>60){
chart.data.labels.shift();
chart.data.datasets[0].data.shift();
}
chart.update();
}

/* ---------- SYSTEM ---------- */
function system(){
const c=avg(values.cosmos);
const p=avg(values.planet);
const e=avg(values.economy);
const s=avg(values.social);
const sys=avg([c,p,e,s]);
const instability=(Math.max(c,p,e,s)-Math.min(c,p,e,s));
const transition=[c,p,e,s].filter(v=>v>0.4&&v<0.7).length/4;
const critical=[c,p,e,s].filter(v=>v>=0.7).length/4;

push(C.c1,c); push(C.c2,p); push(C.c3,e); push(C.c4,s);
push(C.c5,avg([c,p])); push(C.c6,avg([e,s]));
push(C.c7,e); push(C.c8,s);
push(C.c9,sys); push(C.c10,instability);
push(C.c11,transition); push(C.c12,critical);

systemEl.className=level(sys);
systemEl.textContent="SYSTEM STATE: "+(sys<0.4?"STABLE":sys<0.7?"TRANSITION":"CRITICAL");
}

/* ---------- INIT ---------- */
const cosmosEl=document.getElementById("cosmos");
const planetEl=document.getElementById("planet");
const economyEl=document.getElementById("economy");
const socialEl=document.getElementById("social");
const systemEl=document.getElementById("system");

(async()=>{
await cosmos();
await planet();
await economy();
await social();
system();
})();
setInterval(()=>location.reload(),60000);
</script>

</body>
</html>
