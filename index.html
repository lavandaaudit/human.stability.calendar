<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium.stability.human.lab.live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* BASE */
html, body {
  width: 100%;
  height: 100%;
  background: #000;
  color: #cfefff;
  font-family: Inter, system-ui, monospace;
  overflow: hidden;
}

/* STAR BACKGROUND */
canvas#stars {
  position: fixed;
  inset: 0;
  z-index: 0;
}

/* UI LAYER */
.wrapper {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.panel {
  width: 94%;
  height: 90%;
  display: flex;
  gap: 16px;
  backdrop-filter: blur(2px);
}

/* LEFT */
.left {
  width: 42%;
  height: 100%;
  border: 1px solid #0ff3;
  padding: 14px;
  overflow-y: auto;
  background: rgba(0,0,0,0.55);
}

.left h2 {
  font-size: 16px;
  margin-bottom: 12px;
  text-align: center;
  color: #7fffd4;
  letter-spacing: 1px;
}

.indicator {
  margin-bottom: 8px;
  font-size: 13px;
  line-height: 1.4;
}

.indicator span {
  color: #9affff;
}

/* RIGHT */
.right {
  width: 58%;
  height: 100%;
  border: 1px solid #0ff3;
  padding: 10px;
  background: rgba(0,0,0,0.55);
}

.right canvas {
  width: 100% !important;
  height: 100% !important;
}

/* MOBILE */
@media (max-width: 900px) {
  .panel {
    flex-direction: column;
  }
  .left, .right {
    width: 100%;
    height: 50%;
  }
}
</style>
</head>

<body>

<!-- STARFIELD -->
<canvas id="stars"></canvas>

<!-- UI -->
<div class="wrapper">
  <div class="panel">

    <!-- LEFT COLUMN -->
    <div class="left">
      <h2>КОСМІЧНІ ТА ГЕОМАГНІТНІ ПОКАЗНИКИ</h2>

      <div class="indicator">Solar Wind Speed (km/s): <span id="sw_speed">—</span></div>
      <div class="indicator">Solar Wind Density (/cc): <span id="sw_density">—</span></div>
      <div class="indicator">Solar Wind Temperature (K): <span id="sw_temp">—</span></div>

      <div class="indicator">IMF Bt – Total Magnetic Field (nT): <span id="imf_bt">—</span></div>
      <div class="indicator">IMF Bz (nT): <span id="imf_bz">—</span></div>
      <div class="indicator">IMF By (nT): <span id="imf_by">—</span></div>

      <div class="indicator">Solar Wind Dynamic Pressure (nPa): <span id="pressure">—</span></div>

      <div class="indicator">Proton Flux &gt;10 MeV: <span id="proton_flux">—</span></div>
      <div class="indicator">Electron Flux &gt;2 MeV: <span id="electron_flux">—</span></div>

      <div class="indicator">Kp Index: <span id="kp">—</span></div>
      <div class="indicator">Dst Index (nT): <span id="dst">—</span></div>
      <div class="indicator">AE Index (Auroral Electrojet): <span id="ae">—</span></div>

      <div class="indicator">Geomagnetic Storm Level (G1–G5): <span id="storm">—</span></div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right">
      <canvas id="breathChart"></canvas>
    </div>

  </div>
</div>

<script>
/* ===== STARFIELD ===== */
const s = document.getElementById("stars");
const ctxS = s.getContext("2d");
let W, H, stars = [];

function resizeStars() {
  W = s.width = innerWidth;
  H = s.height = innerHeight;
  stars = Array.from({ length: 140 }, () => ({
    x: Math.random() * W,
    y: Math.random() * H,
    z: Math.random() * W
  }));
}
resizeStars();
addEventListener("resize", resizeStars);

function drawStars() {
  ctxS.fillStyle = "#000";
  ctxS.fillRect(0,0,W,H);
  ctxS.fillStyle = "#4dd2ff";

  for (let st of stars) {
    st.z -= 0.15;
    if (st.z <= 0) st.z = W;
    const k = 128 / st.z;
    const x = (st.x - W/2) * k + W/2;
    const y = (st.y - H/2) * k + H/2;
    if (x > 0 && x < W && y > 0 && y < H) {
      const size = (1 - st.z / W) * 1.6;
      ctxS.fillRect(x, y, size, size);
    }
  }
  requestAnimationFrame(drawStars);
}
drawStars();

/* ===== CHART ===== */
const labels = [];
const dataBt = [];
const dataBz = [];
const dataPressure = [];
const dataKp = [];

const ctx = document.getElementById('breathChart').getContext('2d');

const breathChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels,
    datasets: [
      { label: 'IMF Bt (nT)', data: dataBt, borderWidth: 1.5, tension: 0.4 },
      { label: 'IMF Bz (nT)', data: dataBz, borderWidth: 1.5, tension: 0.4 },
      { label: 'Dynamic Pressure (nPa)', data: dataPressure, borderWidth: 1.5, tension: 0.4 },
      { label: 'Kp Index', data: dataKp, borderWidth: 1.5, tension: 0.4 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { ticks: { color: '#9ff', font:{size:10} }, grid:{ color:'#033' } },
      y: { ticks: { color: '#9ff', font:{size:10} }, grid:{ color:'#033' } }
    },
    plugins: {
      legend: { labels: { color:'#cff', font:{size:11} } }
    }
  }
});

/* ===== DATA ===== */
async function updateData() {
  try {
    const plasma = await fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-1-day.json").then(r=>r.json());
    const mag = await fetch("https://services.swpc.noaa.gov/products/solar-wind/mag-1-day.json").then(r=>r.json());
    const kp = await fetch("https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json").then(r=>r.json());

    const p = plasma.at(-1);
    const m = mag.at(-1);
    const k = kp.at(-1);

    const time = new Date().toLocaleTimeString();

    labels.push(time);
    if (labels.length > 30) {
      labels.shift();
      dataBt.shift();
      dataBz.shift();
      dataPressure.shift();
      dataKp.shift();
    }

    dataBt.push(+m[6]);
    dataBz.push(+m[5]);
    dataPressure.push(+p[7]);
    dataKp.push(+k[1]);

    sw_speed.textContent = p[2];
    sw_density.textContent = p[1];
    sw_temp.textContent = p[3];
    imf_bt.textContent = m[6];
    imf_bz.textContent = m[5];
    imf_by.textContent = m[4];
    pressure.textContent = p[7];
    kp.textContent = k[1];

    dst.textContent = "NOAA realtime";
    ae.textContent = "Auroral active";
    proton_flux.textContent = "GOES";
    electron_flux.textContent = "GOES";

    const kpVal = +k[1];
    storm.textContent =
      kpVal >= 8 ? "G4–G5" :
      kpVal >= 7 ? "G3" :
      kpVal >= 6 ? "G2" :
      kpVal >= 5 ? "G1" : "Quiet";

    breathChart.update();
  } catch(e) {
    console.error("DATA ERROR", e);
  }
}

updateData();
setInterval(updateData, 60000);
</script>

</body>
</html>
